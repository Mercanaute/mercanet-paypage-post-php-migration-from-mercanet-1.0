[Read this page in French](README.FR.md)

## Mercanet Paypage POST sample PHP for Mercanet V1 customers

The sample PHP code in this repository is for **Mercanet V1 customers (using APIs) migrating to [Mercanet Paypage POST](https://documentation.mercanet.bnpparibas.net/index.php?title=Connecteur_POST) and keeping their merchantId**.

Various use cases are given as an example: payment on order, deferred payment, etc.

To make your migration to Mercanet V2 as simple as possible, the code in this repository is configured by default to re-use a Mercanet V1 reference: the transactionId on 6 digits. It is called s10TransactionReference on Mercanet V2.

If you use a new merchantId natively with Mercanet V2, please refer instead to the Mercanet online documentation and to the following repository: [https://github.com/Mercanaute/mercanet-paypage-post-php](https://github.com/Mercanaute/mercanet-paypage-post-php).

### Content

**1. Common directory**

This directory includes files used by various use cases.

- sealCalculationPaypageJson.php: this file includes functions to compute the seal with 2 algorithms: [HMAC-SHA-256](https://documentation.mercanet.bnpparibas.net/index.php?title=Connecteur_POST#Outil_de_calcul_de_la_signature) and [SHA-256](https://documentation.mercanet.bnpparibas.net/index.php?title=Connecteur_POST#Outil_de_calcul_de_la_signature)
- paymentResponse.php: displays the manual response following the payment request, after verifying the seal received
- flatten.php: includes various functions to return a string of characters to be sent to the Mercanet V2 server so as to to initiate a payment with Mercanet Paypage POST
- redirectionForm.php: POST version of the redirection form to Mercanet Paypage
- transactionIdCalculation.php: if needed, generates a transactionId (s10TransactionReference for Mercanet V2) in the same format as the Mercanet V1 API.

**2. Other files**

Each file corresponds to a payment type. It includes the code that initiates the payment request and sends it to the Mercanet V2 server.

The examples are configured to work with the transactionId (s10TransactionReference) generated by PHP. If you generate a transactionId from your information system, edit the payment request file you would like to use and replace "s10TransactionReference" with "s10TransactionId":

```php
// Merchants migrating from Mercanet V1 to Mercanet V2 must provide a transactionId. This easily done below. (second example used as default).
// Example with the merchant's own transactionId (typically when you increment Ids from your database)
 $s10TransactionReference=array(
    "s10TransactionId" => "000001",
// //   "s10TransactionIdDate" => "not needed",   Please note that the date is not needed, WL Sips server will apply its date.
 );
//
// Example with transactionId automatic generation, like the Mercanet V1 API was doing.
// $s10TransactionReference=get_s10TransactionReference();
```

### Starting the tests

- Clone the repository and keep the directory structure as on GitHub
- Change the normalReturnUrl value in parameters.php according to your architecture
- Check the uniqueness of the s10TransactionReference values if the reference is computed by you
- In case of multiple payment (installments), change the dates and transaction reference if necessary
- Run the payment request of your choice on a local web server

### Version

These examples were validated on a WAMP server with PHP 7.3.12, and on a Linux/Debian server with nginx server and PHP 8.0.0.

### Documentation

These code examples are based on our online documentation and on the migration guide to Mercanet V2 for merchants keeping their Mercanet V1 merchantId.

To use your merchantId on our Mercanet V2 production servers, please contact the Mercanet support beforehand by e-mail [assistance.mercanet@bnpparibas.com](mailto:assistance.mercanet@bnpparibas.com) or at 0 825 843 414.

For more information, please refer to the [Mercanet Paypage POST documentation](https://documentation.mercanet.bnpparibas.net/index.php?title=Connecteur_POST).

### License

This repository is open source and available under MIT license. For more information, please read the [THE LICENSE](LICENSE) file.
